name: Archive and Release

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:
    inputs:
      version:
        description: 'Version to release'
        required: true
        type: string

jobs:
  archive:
    name: Archive for App Store
    runs-on: macos-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Select Xcode version
      run: sudo xcode-select -s /Applications/Xcode_15.2.app/Contents/Developer
      
    - name: Show build settings
      run: |
        xcodebuild -project "Little Moon.xcodeproj" \
          -scheme "Little Moon" \
          -showBuildSettings
          
    - name: Build for release (without signing)
      run: |
        xcodebuild clean archive \
          -project "Little Moon.xcodeproj" \
          -scheme "Little Moon" \
          -archivePath "./build/LittleMoon.xcarchive" \
          -destination "generic/platform=iOS" \
          CODE_SIGN_IDENTITY="" \
          CODE_SIGNING_REQUIRED=NO \
          CODE_SIGNING_ALLOWED=NO
      continue-on-error: true
      
    - name: Archive summary
      run: |
        echo "ðŸ“¦ Archive build completed"
        echo "Note: For App Store submission, you need to:"
        echo "1. Archive locally in Xcode"
        echo "2. Sign with your distribution certificate"
        echo "3. Upload to App Store Connect"
